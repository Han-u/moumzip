### IP 기반 이상 탐지

- 첫 의도: 토큰 발급 시점에 IP를 확인해서 재발급이 과도하게 자주 될때 사용자의 IP와 해커의 IP를 확인해서 둘이 다르면 토큰 둘다 없애버리자
- 생각해보니?: 모바일이면 IP 자주 바뀔 수 O. 만약 내가 KTX를 타고 노트북에 공유기 와이파이를 잡는다면 IP확인 주소확인 다 애매해지는 듯한...

그렇다면 IP 기반 이상 탐지는 어떻게 하지? --> 라는 이야기로부터 시작된 여러가지 방법 논의


일반적인 기준과 접근 방법
1. 행동 패턴 분석
트래픽 패턴: 특정 IP 주소의 트래픽 패턴을 시간에 따라 분석하여 비정상적인 변화나 스파이크를 탐지, 특정 시간대에 평소보다 많은 트래픽이 발생하면 이상으로 간주한다.  
세션 지속 시간: 평소보다 너무 짧거나 긴 세션 지속 시간이 비정상으로 간주될 수 있음.


2. 사용자 프로파일링
기기 정보: 모바일 기기의 고유한 특징(예: User-Agent 헤더, 기기 지문)을 사용하여 동일한 사용자인지를 식별. IP 주소가 변경되더라도 동일한 사용자를 추적  
행동 패턴: 사용자의 일반적인 행동 패턴(로그인 시간, 접속 위치 등)을 학습하여 비정상적인 행동을 식별한다.


3. 지리적 위치 분석
위치 기반 탐지: IP 주소의 지리적 위치를 추적하여 갑작스러운 위치 변경을 탐지. (ex. 짧은 시간 안에 두 개의 서로 다른 국가에서 접속)  
위치 일관성: 사용자가 주로 접속하는 위치와 현재 위치를 비교하여 일관성을 체크함.

4. IP 평판 분석
블랙리스트/화이트리스트: 알려진 악성 IP 주소 블랙리스트와 신뢰할 수 있는 IP 주소 화이트리스트를 사용하여 필터링    
평판 점수: 각 IP 주소에 대해 평판 점수를 부여하고, 점수가 낮은 IP 주소는 더 엄격하게 모니터링(오..)

5. 다중 요소 인증(MFA)
추가 인증 단계: 비정상적인 활동이 감지되면 추가 인증(ex. 새로운 IP 주소, 새로운 기기 접속시 인증 요구)

6. 머신 러닝 기반 분석
모델 학습: 머신 러닝 모델을 사용하여 정상적인 트래픽 패턴을 학습하고, 비정상적인 트래픽 탐지


단순한 IP 기반 이상 탐지 구현
1. 기본적인 IP 블랙리스트/화이트리스트 적용
블랙리스트 - 알고있는 IP 주소 차단.  
화이트리스트 - 신뢰하는 IP 주소 허용

2. IP 요청 빈도 체크
각 IP 주소 요청 횟소를 시간단위로 기록해 임계값 초과 요청을 보낸 Ip 주소 차단

3. 지리적 위치 분석
IP 주소의 지리적 위치를 추적해 짧은 시간 내 다른 위치로 이동시 비정상 트래픽으로 간주해 차단

4. 비정상적인 URL 접근 패턴 탐지
특정 IP 주소가 짧은 시간 내 동일한 URL에 반복 접근하는지 모니터링

5. IP 주소로 지리적 위치를 추적
MaxMind GeoIP 데이터베이스 사용 --> 신기

6. IP Geolocation API 사용
다양한 IP 지리적 위치 API 서비스를 이용할 수 있음.

7. 클라이언트 기기 식별 방법
User-Agent 헤더에 브라우저 OS 등 식별. --> 근데 좀 애매

8. 쿠키와 세션
목적클라이언트를 특정할 수 있는 고유한 식별자를 생성하여 쿠키에 저장 --> JWT 있잖아요 + 조작 가능성 

9. Fingerprinting (지문 인식)
브라우저의 User-Agent, Accept 헤더, 플러그인 정보, 화면 해상도 등을 조합하여 클라이언트를 식별함.

10. Device ID (모바일 앱)
모바일 애플리케이션에서 각 기기에 고유한 식별자를 사용함. --> PC도 고유 기기 식별자 쓰고 싶었으나 방법이 없다고 함...ㅜㅜ


### 결론!
현재처럼 진짜 단!순!하 직전 IP만 쌓는 형태는 딱히 의미가 없을 것 같다.  
admin 만이라도 IP가 바뀌면 확인하려고 했으나, 애초에 그럴 거면 AccessControlList에서 IP제어 & 내부망에서만 접속하는 게 낫지 않을까...
